# 聊天摘录功能使用指南

> 版本: v1.0
> 作者: 员工2号
> 日期: 2026-02-06

## 一、功能概述

通过自然对话录入知识库，无需手动填表。

**支持场景：**
- 记录供应商信息
- 记录产品价格
- 记录礼品信息
- 更新现有数据

---

## 二、使用方式

### 2.1 录入供应商

**触发词**：记住、添加、新增、保存 + 供应商/厂家/印刷厂

**示例对话：**
```
👤 用户: 记住张三印刷厂，联系人李四，电话13812345678，主营大幅面喷绘，价格35元/平方

🤖 AI: 已记录供应商信息：
- 名称：张三印刷厂
- 联系人：李四
- 电话：13812345678
- 主营：大幅面喷绘
- 参考价：¥35/㎡

确认保存吗？[确认/取消]

👤 用户: 确认

🤖 AI: ✅ 已保存到供应商库
```

### 2.2 录入产品价格

**触发词**：记住、设置、更新 + 价格/报价

**示例对话：**
```
👤 用户: 名片价格更新一下，500张150元，1000张200元

🤖 AI: 已识别产品价格更新：
- 产品：名片
- 500张：¥150（¥0.30/张）
- 1000张：¥200（¥0.20/张）

确认更新吗？[确认/取消]
```

### 2.3 录入礼品

**触发词**：记住、添加 + 礼品/礼物

**示例对话：**
```
👤 用户: 新到一批保温杯，成本45，卖68，库存200个

🤖 AI: 已识别礼品信息：
- 名称：保温杯
- 成本：¥45
- 售价：¥68
- 库存：200个

确认添加吗？[确认/取消]
```

---

## 三、信息提取规则

### 3.1 供应商字段

| 字段 | 识别关键词 | 示例 |
|------|-----------|------|
| 名称 | 厂、公司、店 | "张三印刷厂" |
| 联系人 | 联系人、找、问 | "联系人李四" |
| 电话 | 电话、手机、号码 | "13812345678" |
| 微信 | 微信、wx | "微信：zhangsan" |
| 地址 | 地址、在、位于 | "在工业园区" |
| 主营 | 主营、做、专门 | "主营喷绘" |
| 设备 | 设备、机器 | "有海德堡对开机" |

### 3.2 产品字段

| 字段 | 识别关键词 | 示例 |
|------|-----------|------|
| 名称 | 产品名 | "名片"、"画册" |
| 价格 | 元、块、¥ | "150元" |
| 数量 | 张、本、个、份 | "500张" |
| 规格 | 开、尺寸、大小 | "16开" |

### 3.3 礼品字段

| 字段 | 识别关键词 | 示例 |
|------|-----------|------|
| 名称 | 礼品名 | "保温杯" |
| 成本 | 成本、进价 | "成本45" |
| 售价 | 卖、售价、零售 | "卖68" |
| 库存 | 库存、有、到货 | "库存200" |

---

## 四、数据流程

```
用户输入
    ↓
AI 解析（提取结构化数据）
    ↓
存入 chat_extracts 表（待确认）
    ↓
用户确认
    ↓
写入目标表（suppliers/products/gift_inventory）
```

---

## 五、注意事项

1. **模糊信息会询问**：如果信息不完整，AI 会追问
2. **重复检测**：如果供应商已存在，会提示是否更新
3. **可撤销**：误录入可以说"删除刚才那条"
4. **批量导入**：大量数据建议用 Excel 模板

---

## 六、供应商群场景

### 6.1 场景说明

供应商在企微群发产品信息，AI 自动解析并录入：

| 群类型 | 目标库 | 说明 |
|--------|--------|------|
| 总部群 | `cloud.*` | 云端产品库，所有门店可见 |
| 门店群 | `tenant.*` | 本地产品库，仅本店可见 |

### 6.2 示例消息

```
供应商发送：
"【新品上架】157g铜版纸画册，16开，单价8元/本，100本起订，3-5天交货"

AI 解析结果：
{
  "name": "画册",
  "specs": {"weight": "157g", "format": "16开"},
  "price": 8,
  "price_unit": "本",
  "min_order_qty": 100,
  "delivery_time": "3-5天"
}
```

### 6.3 支持的字段

| 字段 | 识别示例 |
|------|---------|
| 产品名 | 名片、画册、喷绘、保温杯... |
| 规格 | 157g、16开、A4、90x54mm |
| 价格 | 8元/本、35元/㎡、0.3元/张 |
| 起订量 | 100本起订、MOQ 500 |
| 交期 | 3-5天、当天出货、2个工作日 |

---

## 七、SQL 函数

| 函数 | 用途 |
|------|------|
| `parse_supplier_text()` | 解析供应商信息 |
| `parse_product_text()` | 解析产品价格 |
| `parse_gift_text()` | 解析礼品信息 |
| `parse_supplier_product()` | 解析供应商产品消息 |
| `save_chat_extract()` | 保存摘录记录 |
| `confirm_chat_extract()` | 确认并写入目标表 |
| `reject_chat_extract()` | 拒绝/删除摘录 |
| `extract_product_from_supplier()` | 供应商产品提取（区分云端/本地） |
| `batch_extract_supplier_products()` | 批量处理供应商消息 |
